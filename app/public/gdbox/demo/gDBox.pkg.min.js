!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.gDBox=e()}(this,function(){"use strict";var o,r=function(){};o=!1,r.extend=function(t){var i=null;function e(){o||(i&&(this._superprototype=i.prototype),this.init.apply(this,arguments))}for(var n in this!==r&&(i=this),i&&(o=!0,(e.prototype=new i).constructor=e,o=!1),e.extend=r.extend,t)t.hasOwnProperty(n)&&(e.prototype[n]=i&&"function"==typeof t[n]&&"function"==typeof e.prototype[n]&&/\b_super\b/.test(t[n])?function(t,e){return function(){return this._super=i.prototype[t],e.apply(this,arguments)}}(n,t[n]):t[n]);return e};var b={};function U(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function I(t,e,i){var n=t.activeFeature,o=t.activePoint,r=n.points[o.relationNodesIndex[0]],s=n.points[o.relationNodesIndex[1]],a=Math.sqrt((r.x-s.x)*(r.x-s.x)+(r.y-s.y)*(r.y-s.y)),h=(r.y-s.y)/a,l=(r.x-s.x)/a;return 1===h&&0===l||-1===h&&0===l?{dltx:e,dlty:0}:0===h&&1===l||0===h&&-1===l?{dltx:0,dlty:i}:{dltx:0,dlty:0}}function T(t){var e=t.activeFeature,i=t.activePoint,n=e.points[i.relationNodesIndex[0]],o=e.points[i.index],r=Math.sqrt((n.x-o.x)*(n.x-o.x)+(n.y-o.y)*(n.y-o.y)),s=(n.y-o.y)/r,a=(n.x-o.x)/r;return 0===s&&1===a||0===s&&-1===a?{flag:"y"}:{flag:"x"}}return b.config={version:"1.0.17"},b.Util={},b.Util.createDiv=function(t,e,i,n){var o=document.createElement("div");return o.id=t,(e||0===e)&&(o.style.width=e+"px"),(i||0===i)&&(o.style.height=i+"px"),n&&(o.style.position="absolute"),o.style.zIndex=1,o},b.Util.getDpr=function(){return window.devicePixelRatio||1},b.Util.createCanvas=function(t,e,i,n){var o=document.createElement("canvas"),r=b.Util.getDpr();return o.id=t,o.width=e*r,o.height=i*r,o.style.width=e+"px",o.style.height=i+"px",n&&(o.style.position="absolute"),o},b.Util.transformScreenXYWithDpr=function(t){var e=b.Util.getDpr();return{x:t.x*e,y:t.y*e}},b.Util.isInArray=function(t,e){for(var i in t)if(t[i]===e)return!0;return!1},b.Util.isObjInArray=function(t,e){for(var i in t)if(t[i].id===e.id)return alert("已被添加，请更换图层id"+e.id),!0;return!1},b.Util.setStyle=function(t,e){var i=b.Util.getDpr();return t.fillStyle=e.fillColor,t.strokeStyle=e.strokeColor,t.lineWidth=e.lineWeight*i,t.globalAlpha=e.opacity,!0},b.Util.worldToScreen=function(t,e,i){var n=t.getCenter(),o=n.x,r=n.y,s=parseInt(t.w,10)/2,a=parseInt(t.h,10)/2,h=t.zoom/parseInt(t.w,10);return{x:parseFloat(s)+parseFloat((e-o)/h)+0,y:parseFloat(a)-parseFloat((i-r)/h)+0}},b.Util.worldToScreenDistance=function(t,e,i){var n=t.zoom/parseInt(t.w,10);return{w:parseFloat(e/n),h:parseFloat(i/n)}},b.Util.screenToWorld=function(t,e,i){var n=t.getCenter(),o=n.x,r=n.y,s=parseInt(t.w,10)/2,a=parseInt(t.h,10)/2,h=t.zoom/parseInt(t.w,10);return{x:parseFloat(o)+parseFloat((e-s)*h),y:parseFloat(r)-parseFloat((i-a)*h)}},b.Util.addEvtHandler=function(t,e,i){t["on"+e]=i,"mousewheel"===e&&0===b.Util.getIEVersion()&&t.addEventListener("DOMMouseScroll",i,!1)},b.Util.removeEvtHandler=function(t,e){t["on"+e]=null},b.Util.getMouseXY=function(t,e){var i=0,n=0,o=e.srcElement?e.srcElement:e.target;if(1!==o.nodeType)return{x:i,y:n};if(document.attachEvent){var r="medium"===b.Util.getEleStyle(o,"border-top-width")?0:b.Util.delpx(b.Util.getEleStyle(o,"border-top-width")),s="medium"===b.Util.getEleStyle(o,"border-left-width")?0:b.Util.delpx(b.Util.getEleStyle(o,"border-left-width"));i=e.layerX-s,n=e.layerY-r}else{for(;o&&o!==t;){var a="medium"===b.Util.getEleStyle(o,"border-top-width")?0:b.Util.delpx(b.Util.getEleStyle(o,"border-top-width")),h="medium"===b.Util.getEleStyle(o,"border-left-width")?0:b.Util.delpx(b.Util.getEleStyle(o,"border-left-width"));i+=o.offsetLeft+h,n+=o.offsetTop+a,o=o.offsetParent}i=e.offsetX+i+document.body.scrollLeft,n=e.offsetY+n+document.body.scrollTop}return{x:i,y:n}},b.Util.getMousePos=function(t){var e=t||window.event;return{x:e.screenX,y:e.screenY}},b.Util.getEleStyle=function(t,e){var i=e.split("-"),n=i[0];if(1<n.length)for(var o=1;o<i.length;o++)n+=i[o].substring(0,1).toUpperCase()+i[o].substring(1);else n=e;return t.currentStyle?t.currentStyle[n]:document.defaultView.getComputedStyle(t,!1)[n]},b.Util.delpx=function(t){return t?parseInt(t.substring(0,t.length-2),10):0},b.Util.getRectPointsWithSAndE=function(t,e){var i=e.x,n=t.y,o=t.x,r=e.y;return[{x:t.x,y:t.y},{x:i,y:n},{x:e.x,y:e.y},{x:o,y:r}]},b.Util.pointInPoly=function(t,e){for(var i=!1,n=-1,o=e.length,r=o-1;++n<o;r=n)(e[n].y<=t.y&&t.y<e[r].y||e[r].y<=t.y&&t.y<e[n].y)&&t.x<(e[r].x-e[n].x)*(t.y-e[n].y)/(e[r].y-e[n].y)+e[n].x&&(i=!i);return i},b.Util.preventDefault=function(t){t.preventDefault?t.preventDefault():window.event.returnValue=!1},b.Util.stopPropagation=function(t){t.stopPropagation?t.stopPropagation():window.event.cancelBubble=!0},b.Util.getButton=function(t){if(t=t||window.event,!+[1])switch(t.button){case 0:case 1:case 3:case 5:case 7:return 0;case 2:case 6:return 2;case 4:return 1}return t.button},b.Util.createTextArea=function(t,e,i,n){var o=document.createElement("textarea");return o.id=t,o.style.width=e+"px",o.style.height=i+"px",o.style.resize="none",n&&(o.style.position="absolute"),o.style.zIndex=1,o},b.Util.colorRgb=function(t,e){return"rgba("+parseInt("0x"+t.slice(1,3))+","+parseInt("0x"+t.slice(3,5))+","+parseInt("0x"+t.slice(5,7))+","+e+")"},b.Util.getIEVersion=function(){var t=window.navigator.userAgent.toLowerCase();return/msie 8\.0/i.test(t)?8:/msie 7\.0/i.test(t)?7:/msie 6\.0/i.test(t)?6:0},b.Util.formatGeoPointsWithDlt=function(t,e,i,n){for(var o=e.length,r=t.getZoom()/t.getSize().w,s=i*r,a=n*r,h=[],l=0;l<o;l++){var u=e[l];h.push({x:u.x+s,y:u.y-a})}return h},b.Util.formatGeoPointsWithDeleteIndex=function(t,e){for(var i=t.length,n=[],o=0;o<i;o++){var r=t[o];(o!==e||i<=3)&&n.push({x:r.x,y:r.y})}return n},b.Util.calRectNewPointsWithNodesIndexTmpPoint=function(t,e,i,n,o){for(var r=e.length,s=t.getZoom()/t.getSize().w,a=n*s,h=o*s,l=[],u=[],c=0;c<r;c++){var d=e[c],y=b.Util.worldToScreen(t,d.x,d.y);-1!==i.indexOf(c)?(l.push({x:d.x+a,y:d.y-h}),u.push({x:y.x+n,y:y.y+o})):(l.push({x:d.x,y:d.y}),u.push({x:y.x,y:y.y}))}return{points:l,sPoints:u}},b.Util.calPolygonNewPointsWithNodesIndexTmpPoint=function(t,e,i,n){for(var o=e.length,r=[],s=[],a=0;a<o;a++){var h=e[a],l=b.Util.worldToScreen(t,h.x,h.y);if(r.push({x:h.x,y:h.y}),s.push({x:l.x,y:l.y}),a===i){r.push({x:n.x,y:n.y});var u=b.Util.worldToScreen(t,n.x,n.y);s.push({x:u.x,y:u.y})}}return{points:r,sPoints:s}},b.Util.calRectNewPointsWithNodesIndexFormalPoint=function(t,e,i,n,o,r,s){for(var a=e.length,h=t.getZoom()/t.getSize().w,l=o*h,u=r*h,c=[],d=[],y=0;y<a;y++){var f=e[y],p=b.Util.worldToScreen(t,f.x,f.y),g=i.indexOf(y);"y"===s&&0===g||"x"===s&&1===g?(c.push({x:f.x,y:f.y-u}),d.push({x:p.x,y:p.y+r})):"y"===s&&1===g||"x"===s&&0===g?(c.push({x:f.x+l,y:f.y}),d.push({x:p.x+o,y:p.y})):y===n?(c.push({x:f.x+l,y:f.y-u}),d.push({x:p.x+o,y:p.y+r})):(c.push({x:f.x,y:f.y}),d.push({x:p.x,y:p.y}))}return{points:c,sPoints:d}},b.Util.calPolygonNewPointsWithNodesIndexFormalPoint=function(t,e,i,n,o){for(var r=e.length,s=t.getZoom()/t.getSize().w,a=n*s,h=o*s,l=[],u=[],c=0;c<r;c++){var d=e[c],y=b.Util.worldToScreen(t,d.x,d.y);c===i?(l.push({x:d.x+a,y:d.y-h}),u.push({x:y.x+n,y:y.y+o})):(l.push({x:d.x,y:d.y}),u.push({x:y.x,y:y.y}))}return{points:l,sPoints:u}},b.Util.getBounds=function(t){if(!t.length)return[];for(var e=t[0].x,i=t[0].y,n=t[0].x,o=t[0].y,r=1;r<t.length;r++)e>t[r].x&&(e=t[r].x),n<t[r].x&&(n=t[r].x),i>t[r].y&&(i=t[r].y),o<t[r].y&&(o=t[r].y);return[{x:e,y:o},{x:n,y:o},{x:n,y:i},{x:e,y:i}]},b.Util.Key={},b.Util.Key.EVENT="on",b.Util.Key.FLAG={},b.Util.Key.EVENTS={},b.Util.Key.addEventListener=function(t,e){var i=t.join("_");b.Util.Key.EVENTS[i]=e},b.Util.Key.removeEventListener=function(t){var e=t.join("_");delete b.Util.Key.EVENTS[e]},document.addEventListener("keydown",function(t){var e=t.keyCode;if(b.Util.Key.FLAG[e]=!0,"off"!==b.Util.Key.EVENT)for(var i in b.Util.Key.EVENTS){var n=i.split("_"),o=b.Util.Key.EVENTS[i],r=!0;n.forEach(function(t){b.Util.Key.FLAG[1*t]||(r=!1)}),r&&o()}}),document.addEventListener("keyup",function(t){var e=t.keyCode;b.Util.Key.FLAG[e]=!1}),b.Util.Key.isActive=function(t){return b.Util.Key.FLAG[t+""]},b.Graph={},b.Graph.drawPoint=function(t,e){var i=b.Util.transformScreenXYWithDpr(e),n=b.Util.getDpr();t.beginPath(),t.arc(i.x,i.y,3*n,0,2*Math.PI,!0),t.closePath(),t.fill()},b.Graph.drawPoints=function(t,e){for(var i=0;i<e.length;i++){var n={x:e[i].x,y:e[i].y};this.drawPoint(t,n)}},b.Graph.drawLine=function(t,e,i){t.beginPath();var n=b.Util.transformScreenXYWithDpr(e),o=b.Util.transformScreenXYWithDpr(i);t.moveTo(n.x,n.y),t.lineTo(o.x,o.y),t.closePath(),t.stroke()},b.Graph.drawRect=function(t,e,i,n){var o=b.Util.getDpr(),r=b.Util.transformScreenXYWithDpr(e);t.strokeRect(r.x,r.y,i*o,n*o)},b.Graph.drawGeoRect=function(t,e,i,n,o){var r=b.Util.getDpr(),s=b.Util.worldToScreen(t,i.x,i.y),a=b.Util.worldToScreenDistance(t,n,o),h=b.Util.transformScreenXYWithDpr(s);e.strokeRect(h.x,h.y,a.w*r,a.h*r)},b.Graph.drawPolygon=function(t,e){var i=e.length;if(2<=i){t.beginPath();var n=b.Util.transformScreenXYWithDpr(e[0]);t.moveTo(n.x,n.y);for(var o=1;o<i;o++)n=b.Util.transformScreenXYWithDpr(e[o]),t.lineTo(n.x,n.y);t.closePath()}t.stroke()},b.Graph.drawGeoPoint=function(t,e,i){var n=b.Util.worldToScreen(t,i.x,i.y),o=b.Util.transformScreenXYWithDpr(n),r=b.Util.getDpr();e.beginPath(),e.arc(o.x,o.y,3*r,0,2*Math.PI,!0),e.closePath(),e.fill()},b.Graph.drawGeoLineWith=function(t,e,i,n){var o=b.Util.worldToScreen(t,i.x,i.y),r=b.Util.worldToScreen(t,n.x,n.y),s=b.Util.transformScreenXYWithDpr(o),a=b.Util.transformScreenXYWithDpr(r);e.beginPath(),e.moveTo(s.x,s.y),e.lineTo(a.x,a.y),e.closePath(),e.stroke()},b.Graph.drawGeoPoints=function(t,e,i){for(var n=0;n<i.length;n++){var o=b.Util.worldToScreen(t,i[n].x,i[n].y);this.drawPoint(e,o)}},b.Graph.drawGeoPolygon=function(t,e,i){var n=i.length;if(2<=n){e.beginPath();var o=b.Util.worldToScreen(t,i[0].x,i[0].y),r=b.Util.transformScreenXYWithDpr(o);e.moveTo(r.x,r.y);for(var s=1;s<n;s++){var a=b.Util.worldToScreen(t,i[s].x,i[s].y),h=b.Util.transformScreenXYWithDpr(a);e.lineTo(h.x,h.y)}e.closePath()}e.stroke()},b.Graph.drawDashGeoPolygon=function(t,e,i){var n=i.length;if(2<=n){e.beginPath();var o=b.Util.worldToScreen(t,i[0].x,i[0].y),r=b.Util.transformScreenXYWithDpr(o);e.moveTo(r.x,r.y);for(var s=1;s<n;s++){var a=b.Util.worldToScreen(t,i[s].x,i[s].y),h=b.Util.transformScreenXYWithDpr(a);if(e.lineTo(h.x,h.y),s===n-1){if(e.stroke(),n<=2)return;var l=e.globalAlpha;e.setLineDash([10,20]),e.globalAlpha=.3,e.beginPath(),e.moveTo(h.x,h.y),e.lineTo(r.x,r.y),e.stroke(),e.setLineDash([]),e.globalAlpha=l}}}},b.Graph.drawText=function(t,e,i,n){var o=b.Util.transformScreenXYWithDpr({x:i,y:n});e.fillText(t,o.x,o.y)},b.Graph.drawGeoText=function(t,e,i,n,o){var r=b.Util.worldToScreen(t,n,o),s=b.Util.transformScreenXYWithDpr(r);i.fillText(e,s.x,s.y)},b.Geometry=r.extend({init:function(t){this.name=t},getVertices:function(){},getBounds:function(){},calcBounds:function(){}}),b.Geometry.Point=r.extend({init:function(t,e){this.x=t,this.y=e,this.className="point"}}),b.Geometry.LineString=b.Geometry.extend({init:function(t){this.className="line",this.points=[];for(var e=0;e<t.length;e++){var i=t[e];i instanceof b.Geometry.Point?this.points.push(i):alert("初始化节点失败！")}},addPoint:function(t,e){/^\d+$/.test(e)?this.points.splice(e,0,t):this.points.push(t)},delPoint:function(t){this.points.splice(t,1)},removePoint:function(t){for(var e=0;e<this.points.length;e++)if(this.points[e]===t){this.points.splice(e,1);break}},getLength:function(){for(var t=this.points.length,e=0,i=0;i<t-1;i++){e+=Math.sqrt((this.points[i].x-this.points[i+1].x)*(this.points[i].x-this.points[i+1].x)+(this.points[i].y-this.points[i+1].y)*(this.points[i].y-this.points[i+1].y))}return e}}),b.Geometry.LinearRing=b.Geometry.LineString.extend({init:function(t){if(t.length<=2)alert("组成多边形节点个数不足！");else{this._super(t),this.className="polygon";var e=t[0];this.points.push(e)}},addPoint:function(t,e){this.points.splice(e,0,t)},delPoint:function(t){if(4!==this.points.length){if(this.points.splice(t,1),0===t){this.points.pop();var e=this.points[0];this.points.push(e)}}else alert("节点数低于3个，不能删除！")},getCenterPoint:function(){for(var t=this.points,e=t.length,i=0,n=0,o=0;o<e;o++)i+=t[o].x,n+=t[o].y;var r=i/e,s=n/e;return new b.Geometry.Point(r,s)},getArea:function(){for(var t=0,e=this.points,i=0;i<e.length;i++)t+=e[i].x*e[(i+1)%e.length].y-e[(i+1)%e.length].x*e[i].y;return parseInt(Math.abs(.5*t),10)}}),b.Geometry.RectRing=b.Geometry.LineString.extend({init:function(t){t.length<4?alert("组成矩形节点个数不足！"):(this._super(t),this.className="rect")},addPoint:function(t,e){this.points.splice(e,0,t)},delPoint:function(t){if(4!==this.points.length){if(this.points.splice(t,1),0===t){this.points.pop();var e=this.points[0];this.points.push(e)}}else alert("节点数低于3个，不能删除！")},getArea:function(){for(var t=0,e=this.points,i=0;i<e.length;i++)t+=e[i].x*e[(i+1)%e.length].y-e[(i+1)%e.length].x*e[i].y;return parseInt(Math.abs(.5*t),10)}}),b.Geometry.RadiusRing=b.Geometry.extend({init:function(t,e){this.radius=e,this.centerPoint=t,this.className="radius"},getArea:function(){return 6.28318*this.radius*this.radius}}),b.Feature=r.extend({init:function(t,e,i,n){this.activeSatus=!1,this.hoverStatus=!1,this.visible=!1,this.id=t,this.points=e,this.data=i||{},this.gStyle=n},onAdd:function(t){this._layerID=t.id,this._layer=t,this.visible=!0,this.setEditVertices(),this.style=this.gStyle||t.featureStyle||new b.Style({}),this.hoveStyle=t.featureHoverStyle||new b.Style({strokeColor:"#FF0000",lineWeight:1}),this.activeStyle=t.featureActiveStyle||new b.Style({strokeColor:"#FF0000",lineWeight:1}),this.onDraw(t)},onRemove:function(t){},getVertices:function(){return this.points},setEditVertices:function(){for(var t=this.points,e=t.length,i=this._layer.getMap(),n=[],o=0;o<e-1;o++){var r=t[o],s=t[o+1],a=-1<o-1?o-1:e-1,h=(t[a].y-s.y)/(t[a].x-s.x);n.push({point:r,sPoint:b.Util.worldToScreen(i,r.x,r.y),type:"formal",index:o,k:-1/h,relationNodesIndex:[a,o+1]});var l={x:(r.x+s.x)/2,y:(r.y+s.y)/2},u=(s.y-r.y)/(s.x-r.x);if(n.push({point:l,sPoint:b.Util.worldToScreen(i,l.x,l.y),type:"tmp",index:o,k:-1/u,relationNodesIndex:[o,o+1]}),o===e-2){var c=(t[0].y-r.y)/(t[0].x-r.x);n.push({point:s,sPoint:b.Util.worldToScreen(i,s.x,s.y),type:"formal",index:o+1,k:-1/c,relationNodesIndex:[o,0]});var d=t[0],y={x:(d.x+s.x)/2,y:(d.y+s.y)/2},f=(t[0].y-s.y)/(t[0].x-s.x);n.push({point:y,sPoint:b.Util.worldToScreen(i,y.x,y.y),type:"tmp",index:o,k:-1/f,relationNodesIndex:[o+1,0]})}}this._editPoints=n},catchPointWithPos:function(t){if(!this.visible)return{flag:!1,point:null};for(var e=this._editPoints,i=this._layer.getMap(),n=b.Util.worldToScreen(i,t.x,t.y),o=e.length,r=0;r<o;r++){var s=e[r].sPoint,a=(n.x-s.x)*(n.x-s.x)+(n.y-s.y)*(n.y-s.y);if(Math.sqrt(a)<=10)return{flag:!0,point:e[r]}}return{flag:!1,point:null}},show:function(){this.visible||(this.visible=!0,this._layer.renew())},hide:function(){this.visible&&(this.visible=!1,this._layer.renew())},update:function(t){this.points=t.points||this.points,this.data=t.data||this.data,this.style=t.style||this.style,t.points&&this.setEditVertices(),this._layer.renew()},pointInFeature:function(t){return!(!b.Util.pointInPoly(t,this.points)||!this.visible)},hover:function(t){this.hoverStatus||(this.hoveStyle=t||this.hoveStyle,this.hoverStatus=!0,this._layer.renew())},deHover:function(){this.hoverStatus&&(this.hoverStatus=!1,this._layer.renew())},active:function(t){this.activeSatus||(this.activeStyle=t||this.activeStyle,this.activeSatus=!0,this._layer.renew())},deActive:function(){this.activeSatus&&(this.activeSatus=!1,this._layer.renew())},getStyle:function(){return this.activeSatus||this.hoverStatus,this.style},onDraw:function(t){if(this.visible){var e=t.getCtx(),i=this.getStyle(),n=b.Util.getDpr();b.Util.setStyle(e,i),this.hoverStatus&&!this.activeSatus&&(e.lineWidth=2*i.lineWeight*n),i.lineDash?e.setLineDash([10,5]):e.setLineDash([]);var o=t.getMap();e.globalAlpha=1,this.activeSatus&&(e.strokeStyle="#FF0000");var r=this.points.length;if(2<=r){e.beginPath();var s=b.Util.worldToScreen(t._map,this.points[0].x,this.points[0].y),a=b.Util.transformScreenXYWithDpr(s);e.moveTo(a.x,a.y);for(var h=1;h<r;h++)s=b.Util.worldToScreen(t._map,this.points[h].x,this.points[h].y),a=b.Util.transformScreenXYWithDpr(s),e.lineTo(a.x,a.y);e.closePath()}if(e.stroke(),t._opacity?e.globalAlpha=0:e.globalAlpha=this.style.opacity,e.fill(),this.activeSatus){var l=this._editPoints.filter(function(t){return"formal"===t.type}),u=this._editPoints.filter(function(t){return"tmp"===t.type});e.globalAlpha=1,e.fillStyle="#FF0000",b.Graph.drawGeoPoints(o,e,l.map(function(t){return t.point})),e.globalAlpha=1,e.fillStyle="#FF9900",b.Graph.drawGeoPoints(o,e,u.map(function(t){return t.point}))}}},getBounds:function(){for(var t=this.getVertices(),e=t[0].x,i=t[0].y,n=t[0].x,o=t[0].y,r=1;r<t.length;r++)e>t[r].x&&(e=t[r].x),n<t[r].x&&(n=t[r].x),i>t[r].y&&(i=t[r].y),o<t[r].y&&(o=t[r].y);return[{x:e,y:o},{x:n,y:o},{x:n,y:i},{x:e,y:i}]},calcBounds:function(){}}),b.Feature.Rect=b.Feature.extend({init:function(t,e,i,n){this._super(t,e,i,n),this.type="rect"}}),b.Feature.Polygon=b.Feature.extend({init:function(t,e,i,n){this._super(t,e,i,n),this.type="polygon"}}),b.Marker=r.extend({init:function(t,e){this.id=t,this._img=new Image,this._img.src=e.src,this.src=e.src,this._img.style.position="absolute",this._img.style.zIndex=100,this.info=e},onAdd:function(t){var e=(this._layer=t).getMap(),i=this._container=t.getLayerContainer();this.x=this.info.x,this.y=this.info.y;var n=b.Util.worldToScreen(e,this.info.x,this.info.y);this._img.style.left=n.x+this.info.offset.x+"px",this._img.style.top=n.y+this.info.offset.y+"px",this._img.style.cursor="pointer",i.appendChild(this._img)},onRemove:function(){this._container.removeChild(this._img)},update:function(t){t.src&&(this._img.src=t.src),t.x&&(this.info.x=t.x),t.y&&(this.info.y=t.y),t.offset&&(this.info.offset=t.offset),this.renew()},regEvent:function(t,e){if("click"===t){var i=this;b.Util.addEvtHandler(this._img,"mousedown",function(t){b.Util.preventDefault(t),b.Util.stopPropagation(t)}),b.Util.addEvtHandler(this._img,"mouseup",function(t){0===b.Util.getButton(t)&&e.apply(i,arguments),b.Util.preventDefault(t),b.Util.stopPropagation(t)}),b.Util.addEvtHandler(this._img,"click",function(t){b.Util.preventDefault(t),b.Util.stopPropagation(t)})}},renew:function(){var t=this._layer.getMap(),e=b.Util.worldToScreen(t,this.info.x,this.info.y);this._img.style.left=e.x+this.info.offset.x+"px",this._img.style.top=e.y+this.info.offset.y+"px"},showInfo:function(){console.log("Hello ...")}}),b.Text=r.extend({init:function(t,e,i){this.id=t,this.startPoint=e.pos,this.offset=e.offset||{x:0,y:0},this.boxWidth="auto",this.boxMaxWidth="initial",e.width||0===e.width?this.boxWidth=e.width:(e.maxWidth||0===e.maxWidth)&&(this.boxMaxWidth=e.maxWidth),this.wrap=e.wrap||!1,this.text=e.text,this.style=i||new b.Style({})},onAdd:function(t){var e=this.id,i=b.Util.createDiv(e,void 0,void 0,!0);i.style.borderWidth=0,this.wrap||(i.style.overflow="hidden",i.style.textOverflow="ellipsis",i.style.whiteSpace="nowrap"),this._textContainer=i,(this._container=t.getLayerContainer()).appendChild(this._textContainer),this._layer=t,this.onDraw(t)},update:function(t){t.pos&&(this.startPoint=t.pos),t.offset&&(this.offset=t.offset),t.text&&(this.text=t.text),t.width&&(this.boxWidth=t.width),t.maxWidth&&(this.boxMaxWidth=t.maxWidth),t.style&&(this.style=t.style),this.renew()},onDraw:function(t){var e=b.Util.worldToScreen(t._map,this.startPoint.x,this.startPoint.y);e.x=e.x+this.offset.x,e.y=e.y+this.offset.y,this._textContainer.style.fontSize=this.style.fontSize+"px",this._textContainer.style.lineHeight=this.style.fontSize+"px",this._textContainer.style.fontFamily=this.style.fontFamily+",SimSun",this._textContainer.style.color=this.style.fontColor,this._textContainer.style.borderRadius="1px",this._textContainer.style.boxSizing="border-box",this._textContainer.style.padding="1px",this._textContainer.style.width="auto"===this.boxWidth?"auto":"".concat(this.boxWidth,"px"),this._textContainer.style.maxWidth="initial"===this.boxMaxWidth?"initial":"".concat(this.boxMaxWidth,"px");var i=this.style.opacity||0===this.style.opacity?this.style.opacity:1,n=b.Util.colorRgb(this.style.bgColor,i);this._textContainer.style.background=n,this._textContainer.textContent=this.text,this.text?this._textContainer.style.display="block":this._textContainer.style.display="none",this._textContainer.style.left=e.x+"px",this._textContainer.style.top=e.y+"px",t._layerContainer.appendChild(this._textContainer)},setText:function(t){this.text=t,this.refresh()},setPosition:function(t,e){this.startPoint.x=t,this.startPoint.y=e},setSize:function(t){var e=t.width,i=t.maxWidth;(e||0===e)&&(this.boxWidth=e),(i||0===i)&&(this.boxMaxWidth=i)},onRemove:function(){this._container.removeChild(this._textContainer)},getContainer:function(){return this._textContainer},renew:function(){var t=this._layer;this.onDraw(t)},refresh:function(){this.renew()}}),b.Style=r.extend({init:function(t){this.oStyle="singleStyle",this.fillColor=t.fillColor?t.fillColor:"#00DD00",this.strokeColor=t.strokeColor?t.strokeColor:"#00DD00",this.lineWeight=t.lineWeight?t.lineWeight:1,this.borderStatus=!t.borderStatus||t.borderStatus,this.cirRadius=t.cirRadius?t.cirRadius:3,this.fillStatus=!t.fillStatus||t.fillStatus,this.vtxStatus=!!t.vtxStatus&&t.vtxStatus,this.vtxRadius=t.vtxRadius?t.vtxRadius:3,this.tlr=t.tlr?t.tlr:5,this.opacity=t.opacity||0===t.opacity?t.opacity:1,this.mappingValue=t.mappingValue?t.mappingValue:"default",this.fontSize=t.fontSize?t.fontSize:13,this.fontFamily=t.fontFamily?t.fontFamily:"KaiTi",this.fontColor=t.fontColor?t.fontColor:"#333333",this.bgColor=t.bgColor?t.bgColor:"#ffffff",this.lineDash=t.lineDash||!1}}),b.StyleEx=r.extend({init:function(t,e){this.oStyle="multiStyles",this.styles=t,this.mappingField=e}}),b.Edit={},b.Edit.mouseDown=function(t,e){var i=b.Util.getMouseXY(t._container,e),n=b.Util.screenToWorld(t,i.x,i.y),o=t.mode;switch(o){case"drawRect":case"drawPolygon":if(t.activeFeature){var r=t.activeFeature.type;if("rect"===r)t.dragging=!0;else if("polygon"===r){var s=b.Util.getButton(e),a=t.activePoint;if(a&&"formal"===a.type&&2===s){var h=t.activeFeature.points,l=b.Util.formatGeoPointsWithDeleteIndex(h,t.activePoint.index);t.userGeometryEditDone&&t.userGeometryEditDone("polygon",t.activeFeature,l)}else t.dragging=!0}}else{t.resetLayerStatus("active");var u=new b.Geometry.Point(n.x,n.y);"drawRect"===o?t.drawGeometryPoints.push(u):"drawPolygon"===o&&(t.tipLayer.setGeoText("ctrl+z撤销",n.x,n.y),t.drawGeometryPoints.push(u))}}},b.Edit.mouseMove=function(t,e){var i=t.overLayer.getCtx(),n=e.srcElement?b.Util.getMouseXY(t._container,e):e,o=b.Util.screenToWorld(t,n.x,n.y),r=n.x-t.startX,s=n.y-t.startY,a=t.mode,h=t.drawGeometryPoints,l=h.length;switch(a){case"drawRect":case"drawPolygon":t.overLayer.clear(),t.tipLayer.clear(),t.globalStyle?b.Util.setStyle(i,t.globalStyle):t.overLayer.setInitStyle();var u=t.activeFeature,c=t.hoverFeature;if(u){var d=t.activePoint,y=u.points,f=u.type;if(t.dragging)if(t.overLayer.setEditStyle(),t.overLayer.topzIndex(),u.visible&&u.hide(),d){var p=[],g=t.activePoint,v=g.type,x=g.relationNodesIndex,m=g.index;if("tmp"===v)if("rect"===f){var w=I(t,r,s);p=b.Util.calRectNewPointsWithNodesIndexTmpPoint(t,y,x,w.dltx,w.dlty)}else"polygon"===f&&(p=b.Util.calPolygonNewPointsWithNodesIndexTmpPoint(t,y,x[0],o));else if("formal"===v)if("rect"===f){var _=T(t);p=b.Util.calRectNewPointsWithNodesIndexFormalPoint(t,y,x,m,r,s,_.flag)}else"polygon"===f&&(p=b.Util.calPolygonNewPointsWithNodesIndexFormalPoint(t,y,m,r,s));b.Graph.drawPolygon(i,p.sPoints),t.userGeometryEditing&&t.userGeometryEditing(f,u,p.points)}else{var C=b.Util.formatGeoPointsWithDlt(t,y,r,s);b.Graph.drawGeoPolygon(t,i,C),t.userGeometryEditing&&t.userGeometryEditing(f,u,C)}else d&&"formal"===d.type&&3<y.length&&"polygon"===f&&t.tipLayer.setGeoText("右键删除节点",o.x,o.y)}else if(0<l)if(t.overLayer.topzIndex(),"drawRect"===a){var S=[h[0],{x:o.x,y:h[0].y},o,{x:h[0].x,y:o.y}];b.Graph.drawGeoPolygon(t,i,S)}else{1<l&&t.tipLayer.setGeoText("双击结束绘制",o.x,o.y);var P=[].concat(U(h),[o]);b.Graph.drawDashGeoPolygon(t,i,P)}else c&&t.tipLayer.setGeoText("双击选择编辑",o.x,o.y)}return!0},b.Edit.mouseUp=function(t,e){var i=b.Util.getMouseXY(t._container,e),n=b.Util.screenToWorld(t,i.x,i.y),o=i.x-t.startX,r=i.y-t.startY,s=t.mode;switch(s){case"drawRect":case"drawPolygon":var a=t.activeFeature,h=t.activePoint,l=t.dragging;if(a){var u=a.points,c=a.type,d="drawRect"===s?"rect":"polygon";if(l){t.overLayer.clear();var y=[];if(h){var f=h.type,p=h.relationNodesIndex,g=h.index,v=[];if("tmp"===f)if("rect"===c){var x=I(t,o,r);v=b.Util.calRectNewPointsWithNodesIndexTmpPoint(t,u,p,x.dltx,x.dlty)}else"polygon"===c&&(v=b.Util.calPolygonNewPointsWithNodesIndexTmpPoint(t,u,p[0],n));else if("formal"===f)if("rect"===c){var m=T(t);v=b.Util.calRectNewPointsWithNodesIndexFormalPoint(t,u,p,g,o,r,m.flag)}else"polygon"===c&&(v=b.Util.calPolygonNewPointsWithNodesIndexFormalPoint(t,u,g,o,r));y=v.points}else y=b.Util.formatGeoPointsWithDlt(t,u,o,r);t.userGeometryEditDone&&t.userGeometryEditDone(d,t.activeFeature,y),t.dragging=!1}}else if(0<t.drawGeometryPoints.length&&"drawRect"===s){t.overLayer.clear();var w=t.drawGeometryPoints[0],_=new b.Geometry.Point(n.x,n.y),C=b.Util.getRectPointsWithSAndE(w,_);Math.abs(C[0].x-C[2].x)<2||Math.abs(C[0].y-C[2].y)<2?(t.drawGeometryPoints=[],console.log("invalid points data: 绘制矩形 —— 不是有效矩形框...")):t.drawGeometryPoints=C}}},b.Edit.mouseDblClick=function(t,e){switch(t.mode){case"drawRect":t.tipLayer.clear();break;case"drawPolygon":t.overLayer.clear(),t.tipLayer.clear(),t.drawGeometryPoints.pop(),3<=t.drawGeometryPoints.length||(t.drawGeometryPoints=[],console.log("invalid points data: 绘制多边形 —— 不是有效多边形..."))}},b.Map=r.extend({init:function(t,e){this._options=e||{},this.privateInitContainer(t),this.privateInitProp(),this.privateInitEvent(),this.overLayer=new b.Layer.Overlay("overlay"),this.tipLayer=new b.Layer.Tip("tip"),this.mLayer=new b.Layer.Marker("markerLayer"),this.addLayer(this.overLayer),this.addLayer(this.tipLayer),this.addLayer(this.mLayer),this.attachEvents(),this.registerShortKeyEvent()},attachEvents:function(){var e=this;e.events={on:function(t,n){switch(t){case"boundsChanged":e.userBoundsChanged=function(){n()};break;case"mouseDown":e.userMouseDown=function(t){var e=n(t);return"boolean"!=typeof e||e};break;case"mouseMove":e.userMouseMove=function(t){n(t)};break;case"geometryEditing":e.userGeometryEditing=function(t,e,i){n(t,e,i)};break;case"geometryEditDone":e.userGeometryEditDone=function(t,e,i){n(t,e,i)};break;case"geometryDrawDone":e.userGeometryDrawDone=function(t,e){n(t,e)};break;case"featureHover":e.userFetureHover=function(t){n(t)};break;case"featureSelected":e.userFetureSelected=function(t){n(t)};break;case"featureWillSelected":e.userFetureWillSelected=function(t){n(t)};break;case"featureStatusReset":e.userFeatureStatusReset=function(t){n(t)}}}}},onBoundsChanged:function(){for(var t=this.getAllControls(),e=0;e<t.length;e++)t[e].boundsWatch();this.userBoundsChanged&&this.userBoundsChanged()},registerShortKeyEvent:function(){var t=this;b.Util.Key.addEventListener([17,90],function(){"drawPolygon"===t.mode&&t.drawGeometryPoints.length&&(t.drawGeometryPoints.pop(),b.Edit.mouseMove(t,{x:t.middleX,y:t.middleY}))})},privateInitContainer:function(t){this._container=document.getElementById(t),this._container&&(this._container.innerHTML="",this.w=this._options.w||this._container.clientWidth,this.h=this._options.h||this._container.clientHeight,this._container.style.overflow="hidden",this._container.style.userSelect="none",this._container.oncontextmenu=function(){return!1})},getContainer:function(){return this._container},getSize:function(){return{w:this.w,h:this.h}},privateInitProp:function(){this.mode="pan",this.dragging=!1,this.autoPanTimer=null,this.autoPanFlag=!(0<=[!0,!1].indexOf(this._options.autoPan))||this._options.autoPan,this.autoFeatureSelect=!(0<=[!0,!1].indexOf(this._options.autoFeatureSelect))||this._options.autoFeatureSelect,this.oLayers=[],this.oControls=[],this.zoom=this._options.zoom||parseInt(1*this.w,10),this.cx=this._options.cx||0,this.cy=this._options.cy||0,this.startX=0,this.startY=0,this.startScrX=0,this.startSrcY=0,this.middleX=0,this.middleY=0,this.zoomScale=.025,this.zoomMax=this._options.zoomMax||1e9,this.zoomMin=this._options.zoomMin||0,this.drawGeometryPoints=[],this.activeFeature=null,this.activePoint=null},privateInitEvent:function(){var f=this,t=this._container;b.Util.addEvtHandler(t,"mousedown",function(t){var e=t||window.event;window.event||e.preventDefault();var i=b.Util.getMouseXY(f._container,e),n=b.Util.screenToWorld(f,i.x,i.y),o=b.Util.getMousePos(e);f.startX=i.x,f.startY=i.y,f.startScrX=o.x,f.startScrY=o.y,"pan"===f.mode?(f.resetLayerStatus("active"),function(t){f.dragging=!0;for(var e=f.getAllLayers(),i=0;i<e.length;i++)e[i].startLeft=b.Util.delpx(e[i]._layerContainer.style.left),e[i].startTop=b.Util.delpx(e[i]._layerContainer.style.top)}(),document.onmousemove=function(t){!function(t){var e=b.Util.getMousePos(t);if(f.dragging){var i=e.x-f.startScrX,n=e.y-f.startScrY,o=f.getAllLayers();if(0<Math.abs(i)||0<Math.abs(n))for(var r=0;r<o.length;r++)o[r].onDrag(i,n)}}(t)},document.onmouseup=function(t){document.onmousemove=null,document.onmouseup=null,function(t){var e=b.Util.getMousePos(t),i=e.x-f.startScrX,n=e.y-f.startScrY;if(0<Math.abs(i)||0<Math.abs(n)){var o=f.getScreenCenter(),r=o.x-i,s=o.y-n,a=b.Util.screenToWorld(f,r,s);f.setCenter(a.x,a.y);for(var h=f.getAllLayers(),l=0,u=h.length;l<u;l++)h[l].renew();f.onBoundsChanged()}f.dragging=!1}(t)}):(r=e,b.Edit.mouseDown(f,r));var r;f.userMouseDown&&f.userMouseDown(n)}),b.Util.addEvtHandler(t,"mousemove",function(t){var e=b.Util.getMouseXY(f._container,t),i=b.Util.screenToWorld(f,e.x,e.y);f.middleX=e.x,f.middleY=e.y,("drawPolygon"===f.mode||"drawRect"===f.mode)&&0<f.drawGeometryPoints.length&&(e.x<=10||e.y<=10||e.x>=f.w-10||e.y>=f.h-10)&&!f.autoPanTimer&&f.autoPanFlag?f.autoPanTimer=window.setInterval(function(){return function(t){var e=t.left,i=t.right,n=t.top,o=t.bottom,r=f.getScreenCenter(),s=e?-.2:i?.2:0,a=n?-.2:o?.2:0,h=r.x+s,l=r.y+a,u=b.Util.screenToWorld(f,h,l);f.setCenter(u.x,u.y);for(var c=f.getAllLayers(),d=0,y=c.length;d<y;d++)c[d].renew()}({left:e.x<=10,right:e.x>=f.w-10,top:e.y<=10,bottom:e.y>=f.h-10})},0):f.autoPanTimer&&(window.clearInterval(f.autoPanTimer),f.autoPanTimer=null);!f.dragging&&f.handleDrawEditGeometryMouseMove(i),b.Edit.mouseMove(f,t),f.userMouseMove&&f.userMouseMove(i),!f.dragging&&f.setTargets(i,"hover")}),b.Util.addEvtHandler(t,"mouseup",function(t){var e=b.Util.getMouseXY(f._container,t);b.Util.screenToWorld(f,e.x,e.y);b.Edit.mouseUp(f,t);var i=f.drawGeometryPoints.length;if(f.overLayer.resetzIndex(),i)switch(f.mode){case"drawRect":f.userGeometryDrawDone&&f.userGeometryDrawDone("rect",f.drawGeometryPoints),f.drawGeometryPoints=[]}else f.mode}),b.Util.addEvtHandler(t,"mousewheel",function(t){b.Util.preventDefault(t);var e=b.Util.getMouseXY(f._container,t),i=b.Util.screenToWorld(f,e.x,e.y);if("pan"===f.mode||"drawPolygon"===f.mode||"drawRect"===f.mode){var n=t.wheelDelta||-t.detail;if(0<n){var o=f.getNewZoom("zoomIn",1);if(f.zoom<=f.zoomMin||o<=f.zoomMin)return;var r=(i.x-f.cx)*(1-f.zoomScale),s=(i.y-f.cy)*(1-f.zoomScale),a=i.x-r,h=i.y-s;f.setCenter(a,h),f.zoomIn(1)}else{var l=f.getNewZoom("zoomOut",1);if(f.zoom>=f.zoomMax||l>=f.zoomMax)return;var u=(i.x-f.cx)/(1-f.zoomScale),c=(i.y-f.cy)/(1-f.zoomScale),d=i.x-u,y=i.y-c;f.setCenter(d,y),f.zoomOut(1)}"drawPolygon"!==f.mode&&"drawRect"!==f.mode||!f.drawGeometryPoints.length||b.Edit.mouseMove(f,{x:e.x,y:e.y})}}),b.Util.addEvtHandler(t,"dblclick",function(t){var e=b.Util.getMouseXY(f._container,t),i=b.Util.screenToWorld(f,e.x,e.y);if(b.Edit.mouseDblClick(f,t),f.drawGeometryPoints.length)switch(f.mode){case"drawRect":break;case"drawPolygon":f.userGeometryDrawDone&&f.userGeometryDrawDone("polygon",f.drawGeometryPoints),f.drawGeometryPoints=[]}else switch(f.mode){case"drawRect":case"drawPolygon":!f.activeFeature&&f.setTargets(i,"selected")}})},handleDrawEditGeometryMouseMove:function(r){var s=this;switch(s.mode){case"pan":s.setCursor("pointer");break;case"drawRect":case"drawPolygon":if(function(){for(var t=s.getAllLayers(),e=0;e<t.length;e++)if("featureLayer"===t[e].oClass){var i=t[e].catchFeaturePointWithPos(r,"active");if(i.length)return s.activeFeature=i[0].feature,s.activePoint=i[0].point,!(s.hoverFeature=null);var n=t[e].getFeaturesWithPos(r,"active");if(n.length)return s.activeFeature=n[0],s.activePoint=null,!(s.hoverFeature=null);var o=t[e].getFeaturesWithPos(r,"hover");if(o.length)return s.activeFeature=null,s.activePoint=null,s.hoverFeature=o[0],!1}return s.activeFeature=null,s.activePoint=null,s.hoverFeature=null,!1}()){var t=s.activeFeature;if(s.activePoint&&"rect"===t.type){var e=s.activePoint.k;0<e&&e!==1/0?s.setCursor("nesw-resize"):0===e?s.setCursor("ew-resize"):e<0&&e!==-1/0?s.setCursor("nwse-resize"):s.setCursor("ns-resize")}else s.activePoint&&"polygon"===t.type?s.setCursor("no-drop"):s.setCursor("move")}else s.setCursor("crosshair")}},setTargets:function(t,e){for(var i=this.getAllLayers(),n=[],o=0;o<i.length;o++)n=n.concat(i[o].getFeaturesWithPos(t));if("selected"===e){if(!n.length)return void this.resetLayerStatus("active");this.autoFeatureSelect&&n[0].active(),this.handleDrawEditGeometryMouseMove(t),this.autoFeatureSelect&&this.userFetureSelected&&this.userFetureSelected(n[0]),!this.autoFeatureSelect&&this.userFetureWillSelected&&this.userFetureWillSelected(n[0])}else if("hover"===e){if(this.resetLayerStatus("hover"),!n.length)return;n[0].hover(),this.userFetureHover&&this.userFetureHover(n[0])}return this},resetLayerStatus:function(t){for(var e=this.getAllLayers(),i=!1,n=0;n<e.length;n++)"featureLayer"===e[n].oClass&&e[n].resetFeatureStatus(t)&&(i=!0);return t&&"active"===t&&i&&this.userFeatureStatusReset&&this.userFeatureStatusReset(),i},addLayer:function(t){var e=this.oLayers;b.Util.isObjInArray(e,t)||(t.onAdd(this),e.push(t))},removeLayer:function(t){for(var e=[],i=this.oLayers,n=0,o=0;n<i.length;n++)i[n]!==t?(e[o]=i[n],o++):t.onRemove(this);this.oLayers=e},getAllLayers:function(){return this.oLayers},addControl:function(t){var e=this.oControls;b.Util.isObjInArray(e,t)||(t.onAdd(this),e.push(t))},removeControl:function(t){for(var e=[],i=this.oControls,n=0,o=0;n<i.length;n++)i[n]!==t?(e[o]=i[n],o++):t.onRemove(this);this.oControls=e},getAllControls:function(){return this.oControls},getNewZoom:function(t,e){for(var i=e||6,n=this.zoom;0<i;)"zoomIn"===t?n-=n*this.zoomScale:n/=1-this.zoomScale,i--;return n},getZoom:function(){return this.zoom},setZoom:function(t){this.zoom=t},zoomIn:function(t){var e=this.getNewZoom("zoomIn",t);if(!(this.zoom<=this.zoomMin||e<=this.zoomMin)){var i=this.getAllLayers();this.zoom=e;for(var n=0;n<i.length;n++)i[n].zoomIn();this.onBoundsChanged()}},zoomOut:function(t){var e=this.getNewZoom("zoomOut",t);if(!(this.zoom>=this.zoomMax||e>=this.zoomMax)){var i=this.getAllLayers();this.zoom=e;for(var n=0;n<i.length;n++)i[n].zoomOut();this.onBoundsChanged()}},setMode:function(t,e){switch(this.mode=t,this.drawGeometryPoints=[],t){case"pan":this.resetLayerStatus()}e&&(this.globalStyle=e)},setCursor:function(t){var e=this._container.style.cursor;e!==t&&(this.previousCursor=e,this._container.style.cursor=t)},resetCursor:function(){this.setCursor(this.previousCursor)},getMode:function(){return this.mode},setCenter:function(t,e){this.cx=t,this.cy=e},centerAndZoom:function(t,e){this.setCenter(t.x,t.y),this.setZoom(e);for(var i=this.getAllLayers(),n=0;n<i.length;n++)i[n].zoomIn();this.onBoundsChanged()},getCenter:function(){return{x:this.cx,y:this.cy}},getScreenCenter:function(){return{x:this.w/2,y:this.h/2}},resize:function(t,e){var i=this.zoom/this.w,n=t||this._container.clientWidth,o=e||this._container.clientHeight;this.zoom=i*n,this.w=n,this.h=o;for(var r=this.getAllLayers(),s=0;s<r.length;s++)r[s].resize();for(var a=this.getAllControls(),h=0;h<a.length;h++)a[h].resize();this.onBoundsChanged()},destroy:function(){this._container.innerHTML="";var t=this._container;b.Util.removeEvtHandler(t,"mousedown"),b.Util.removeEvtHandler(t,"mousemove"),b.Util.removeEvtHandler(t,"mouseup"),b.Util.removeEvtHandler(t,"mousewheel")}}),b.Layer=r.extend({init:function(t,e){this.id=t,this.visible=!0,this.options=e||{opacity:1,zIndex:0}},onAdd:function(t){this._map=t,this._container=t.getContainer();var e=t.getSize();this.privateInitLayerContainer(this.id,e.w,e.h),this.privateInitProp(t),this.privateInitParams(t),this._container.appendChild(this._layerContainer),this.setzIndex(),this.setOpacity(this.options.opacity)},onRemove:function(t){t.getContainer().removeChild(this._layerContainer)},privateInitProp:function(t){},privateInitParams:function(t){},onDrag:function(t,e){this._layerContainer.style.left=this.startLeft+t+"px",this._layerContainer.style.top=this.startTop+e+"px"},zoomIn:function(){this.renew()},zoomOut:function(){this.renew()},zoomTo:function(){this.renew()},renew:function(){this._layerContainer.style.left="0px",this._layerContainer.style.top="0px"},getSize:function(){return{w:this._layerContainer.clientWidth,h:this._layerContainer.clientHeight}},getScreenCenter:function(){return{x:parseInt(this._layerContainer.clientWidth/2,10),y:parseInt(this._layerContainer.clientHeight/2,10)}},getMap:function(){return this._map},getLayerContainer:function(){return this._layerContainer},setzIndex:function(){isNaN(this.options.zIndex)||(this._layerContainer.style.zIndex=this.options.zIndex)},setOpacity:function(t){this.getLayerContainer().style.opacity=t},resize:function(){this._layerContainer.style.width=this._map.w+"px",this._layerContainer.style.height=this._map.h+"px"},getFeaturesWithPos:function(t){return[]},deSelect:function(){}}),b.Layer.Image=b.Layer.extend({init:function(t,e,i,n){this._super(t,n),this._src=e,this._size=i,this.oClass="imgLayer",this.isOnload=!1,this.setGridInfo(n.grid)},setGridInfo:function(t){this._gridVisible=!0,this._lineClassName="layer-img-line",this._gridConfig=!!t&&Object.assign({},{rowCount:3,columnCount:3,color:"#000"},this._gridConfig||{},t),this._rowLineProps={position:"absolute",boxSizing:"border-box",height:"1px",width:"100%",left:0,borderTop:"1px solid "+this._gridConfig.color},this._columnLineProps={position:"absolute",boxSizing:"border-box",height:"100%",width:"1px",top:0,borderLeft:"1px solid "+this._gridConfig.color}},privateInitParams:function(t){},privateInitProp:function(t){var e=this;this._super(),this._mapImg||(this._mapImg=new Image),this._mapImg.style.position="absolute",this._mapImg.src=this._src,this._mapImg.style.width="100%",this._mapImg.style.height="100%",this._mapImg.onmousedown=function(t){t.preventDefault()},this._mapImg.onload=function(){e.isOnload=!0},this._innerContainerId=this.id+"-inner-container",this._innerContainer=document.createElement("div"),this._innerContainer.id=this._innerContainerId,this._innerContainer.appendChild(this._mapImg),this._innerContainer.style.position="absolute",this._layerContainer.appendChild(this._innerContainer),this.renew()},privateInitLayerContainer:function(t,e,i){var n=b.Util.createDiv(t,e,i,!0);n.style.zIndex=2,this._layerContainer=n},onAdd:function(t){this._super(t),this.setGrid()},zoomTo:function(){},setGrid:function(){var t=this._gridConfig||{},e=t.columnCount,i=void 0===e?0:e,n=t.rowCount,o=void 0===n?0:n;if(this.removeGrid(),this._gridConfig&&this._gridVisible){for(var r=parseInt(100/o,10),s=parseInt(100/i,10),a=0;a<o-1;a++){var h=document.createElement("div");for(var l in h.className=this._lineClassName,this._rowLineProps)h.style[l]=this._rowLineProps[l];h.style.top=(a+1)*r+"%",this._innerContainer.appendChild(h)}for(var u=0;u<i-1;u++){var c=document.createElement("div");for(var d in c.className=this._lineClassName,this._columnLineProps)c.style[d]=this._columnLineProps[d];c.style.left=(u+1)*s+"%",this._innerContainer.appendChild(c)}}},operateGrid:function(t){var e=document.getElementById(this._innerContainerId);if(e)for(var i=e.getElementsByClassName(this._lineClassName),n=i.length-1;0<=n;n--)"remove"===t&&i[n].remove(),"show"===t&&(i[n].style.display="block"),"hide"===t&&(i[n].style.display="none")},removeGrid:function(){this.operateGrid("remove")},showGrid:function(){this.operateGrid("show")},hideGrid:function(){this.operateGrid("hide")},update:function(t){t&&t.grid&&(this.setGridInfo(t.grid),this.setGrid())},renew:function(){var t=this;this._super();var e=this._map.getSize(),i=this._map.zoom/e.w;this.isOnload?(this._innerContainer.style.width=this._size.w/i+"px",this._innerContainer.style.height=this._size.h/i+"px"):setTimeout(function(){t._innerContainer.style.width=t._size.w/i+"px",t._innerContainer.style.height=t._size.h/i+"px"},0);var n=b.Util.worldToScreen(this._map,-1*this._size.w/2,this._size.h/2);this._innerContainer.style.left=n.x+"px",this._innerContainer.style.top=n.y+"px"},resize:function(){this._super(),this.renew()},refresh:function(){}}),b.Layer.Feature=b.Layer.extend({init:function(t,e){e=e||{},this._super(t,e),this.featureStyle=e.style||new b.Style({}),this.featureHoverStyle=e.hoverStyle||new b.Style({strokeColor:"#FF0000",lineWeight:1}),this.featureActiveStyle=e.activeStyle||new b.Style({strokeColor:"#FF0000",lineWeight:1}),this._opacity=!!e.transparent&&e.transparent,this.oClass="featureLayer"},privateInitLayerContainer:function(t,e,i){var n=b.Util.createCanvas(t,e,i,!0);this._layerContainer=n,this._ctx=n.getContext("2d"),this._layerContainer.style.left="0",this._layerContainer.style.top="0"},privateInitProp:function(t){this._super()},onAdd:function(t){var e=(this._map=t).getSize(),i=this._map.getContainer();this.privateInitLayerContainer(this.id,e.w,e.h),i.appendChild(this._layerContainer),this.setzIndex(),this.oFeatures=[]},addFeature:function(t){var e=this.getAllFeatures();b.Util.isInArray(e,t)||(e.push(t),t.onAdd(this))},getFeatureById:function(t){for(var e=this.getAllFeatures(),i=e.length-1;0<=i;i--)if(e[i].id===t)return e[i];return null},getFeaturesWithPos:function(t,e){for(var i=[],n=this.getAllFeatures(),o=n.length-1;0<=o;o--){var r=n[o],s=!0;e&&"active"===e&&(s=r.activeSatus),e&&"hover"===e&&(s=!0),r.pointInFeature(t)&&s&&i.push(r)}return i},catchFeaturePointWithPos:function(t,e){for(var i=[],n=this.getAllFeatures(),o=n.length-1;0<=o;o--){var r=n[o],s=!0;e&&"active"===e&&(s=r.activeSatus);var a=r.catchPointWithPos(t);a.flag&&s&&i.push({feature:r,point:a.point})}return i},resetFeatureStatus:function(t){for(var e=this.getAllFeatures(),i=!1,n=e.length-1;0<=n;n--){var o=e[n];t&&"active"===t?o.activeSatus&&(i=!(o.activeSatus=!1)):t&&"hover"===t?o.hoverStatus&&(i=!(o.hoverStatus=!1)):(o.activeSatus||o.hoverStatus)&&(o.activeSatus=!1,i=!(o.hoverStatus=!1))}return i&&this.renew(),i},getActiveFeatures:function(){for(var t=[],e=this.getAllFeatures(),i=e.length-1;0<=i;i--)e[i].activeSatus&&t.push(e[i]);return t},getHoverFeatures:function(){for(var t=[],e=this.getAllFeatures(),i=e.length-1;0<=i;i--)e[i].hoverStatus&&t.push(e[i]);return t},removeAllFeatures:function(){this.oFeatures=[],this.renew()},removeFeature:function(t){for(var e=[],i=0,n=0;i<this.oFeatures.length;i++)this.oFeatures[i]!==t?(e[n]=this.oFeatures[i],n++):t.onRemove(this);this.oFeatures=e,this.renew()},removeFeatureById:function(t){for(var e=[],i=0,n=this.oFeatures.length;i<n;i++){var o=this.oFeatures[i];o.id!==t?e.push(o):o.onRemove(this)}this.oFeatures=e,this.renew()},removeFeaturesByIds:function(t){for(var e=[],i=[],n=0,o=this.oFeatures.length;n<o;n++){var r=this.oFeatures[n];-1===t.indexOf(r.id)?e.push(r):(r.onRemove(this),i.push(r))}return this.oFeatures=e,this.renew(),i},removeFeaturesByProperty:function(t){for(var e=[],i=[],n=0,o=this.oFeatures.length;n<o;n++){for(var r=this.oFeatures[n],s=!1,a=0,h=t.length;a<h;a++){var l=t[a];if(r.data[l.key]===l.value){s=!0,r.onRemove(this),i.push(r);break}}s||e.push(r)}return this.oFeatures=e,this.renew(),i},draw:function(){for(var t=this.getAllFeatures(),e=0;e<t.length;e++)t[e].onDraw(this)},renew:function(){this._super(),this.clear(),this.draw()},resize:function(){this._super(),this._layerContainer.width=this._map.w,this._layerContainer.height=this._map.h,this.renew()},clear:function(){var t=this.getLayerContainer();this._ctx.clearRect(0,0,t.width,t.height)},getAllFeatures:function(){return this.oFeatures},getCtx:function(){return this._ctx}}),b.Layer.Overlay=b.Layer.Feature.extend({init:function(t,e){this._super(t,e),this.options=e||{opacity:1,zIndex:10},this.zIndexTopFlag=!1,this.oClass="overlayLayer"},setStyle:function(t){this.style=t},initStyle:function(){this.setInitStyle(),this._layerContainer.style.left="0",this._layerContainer.style.top="0"},setInitStyle:function(){var t=this.getCtx(),e=b.Util.getDpr();t.strokeStyle="#0000FF",t.fillStyle="#0000FF",t.lineWidth=1*e,t.globalAlpha=.7},setEditStyle:function(){var t=this.getCtx(),e=b.Util.getDpr();t.strokeStyle="#FF0000",t.lineWidth=1*e,t.globalAlpha=.7},onAdd:function(t){this._super(t),this.initStyle()},resize:function(){this._super(),this._layerContainer.width=this._map.w,this._layerContainer.height=this._map.h,this.renew()},topzIndex:function(){this.zIndexTopFlag||(this._layerContainer.style.zIndex=9999,this.zIndexTopFlag=!0)},resetzIndex:function(){this.zIndexTopFlag&&(this._layerContainer.style.zIndex=this.options.zIndex,this.zIndexTopFlag=!1)}}),b.Layer.Tip=b.Layer.Feature.extend({init:function(t,e){this._super(t,e),this.options=e||{opacity:1,zIndex:11},this.oClass="tipLayer"},setStyle:function(t){this.style=t},initStyle:function(){this.setInitStyle(),this._layerContainer.style.left="0",this._layerContainer.style.top="0"},setInitStyle:function(){var t=this.getCtx(),e=12*b.Util.getDpr();t.font="".concat(e,"px Arial"),t.textAlign="left",t.textBaseline="bottom",t.fillStyle="#fff",t.globalAlpha=1},onAdd:function(t){this._super(t),this.initStyle()},resize:function(){this._super(),this._layerContainer.width=this._map.w,this._layerContainer.height=this._map.h,this.renew()},setTextBackground:function(t,e,i,n){var o=this.getCtx();o.beginPath(),o.rect(t,e,i,n),o.fillStyle="#333",o.fill(),o.lineWidth=1,o.strokeStyle="#efefef",o.stroke()},setText:function(t,e,i){if(this.clear(),t){var n=this.getCtx(),o=n.measureText(t).width,r=b.Util.transformScreenXYWithDpr({x:e||0,y:i||0}),s=b.Util.getDpr();this.setTextBackground(r.x+4*s,r.y-16*s,o+7*s,20*s),this.setInitStyle(),n.fillText(t,r.x+7*s,r.y+1*s)}},setGeoText:function(t,e,i){if(this.clear(),t){var n=this.getCtx(),o=n.measureText(t).width,r=b.Util.worldToScreen(this._map,e||0,i||0),s=b.Util.transformScreenXYWithDpr(r),a=b.Util.getDpr();this.setTextBackground(s.x+4*a,s.y-16*a,o+7*a,20*a),this.setInitStyle(),n.fillText(t,s.x+7*a,s.y+1*a)}}}),b.Layer.Marker=b.Layer.extend({init:function(t,e){this._super(t,e),this.options=e||{opacity:1,zIndex:20},this.id=t,this.oClass="markerLayer",this.oMarkers=[]},privateInitLayerContainer:function(t,e,i){var n=b.Util.createDiv(t,e,i,!0);this._layerContainer=n},addMarker:function(t){b.Util.isInArray(this.oMarkers,t)||(this.oMarkers.push(t),t.onAdd(this))},removeMarker:function(t){for(var e=[],i=0,n=0;i<this.oMarkers.length;i++)this.oMarkers[i]!==t?(e[n]=this.oMarkers[i],n++):this.oMarkers[i].onRemove(this);this.oMarkers=e,this.renew()},removeMarkerById:function(t){for(var e=[],i=0,n=this.oMarkers.length;i<n;i++){var o=this.oMarkers[i];o.id!==t?e.push(o):o.onRemove(this)}this.oMarkers=e,this.renew()},removeMarkersByIds:function(t){for(var e=[],i=[],n=0,o=this.oMarkers.length;n<o;n++){var r=this.oMarkers[n];-1===t.indexOf(r.id)?e.push(r):(r.onRemove(this),i.push(r))}return this.oMarkers=e,this.renew(),i},getAllMarkers:function(){return this.oMarkers},getMarkerById:function(t){for(var e=0;e<this.oMarkers.length;e++)if(this.oMarkers[e].id===t)return this.oMarkers[e];return null},addMarkers:function(t){for(var e=0;e<t.length;e++)this.addMarker(t[e])},removeMarkers:function(t){for(var e=t,i=e.length,n=0;n<i;n++){var o=e[n];this.removeMarker(o)}},removeAllMarkers:function(){var t=this.oMarkers;this.removeMarkers(t)},renew:function(){this._super();for(var t=0;t<this.oMarkers.length;t++)this.oMarkers[t].renew()},resize:function(){this._super(),this.renew()}}),b.Layer.Text=b.Layer.extend({init:function(t,e){this._super(t,e),this.options=e||{opacity:1,zIndex:19},this.id=t,this.oClass="textLayer",this.oTexts=[]},privateInitLayerContainer:function(t,e,i){var n=b.Util.createDiv(t,e,i,!0);this._layerContainer=n},addText:function(t){b.Util.isInArray(this.oTexts,t)||(this.oTexts.push(t),t.onAdd(this))},removeText:function(t){for(var e=[],i=0,n=0;i<this.oTexts.length;i++)this.oTexts[i]!==t?(e[n]=this.oTexts[i],n++):this.oTexts[i].onRemove(this);this.oTexts=e,this.renew()},getTextById:function(t){for(var e=0;e<this.oTexts.length;e++)if(this.oTexts[e].id===t)return this.oTexts[e];return null},removeTextById:function(t){for(var e=[],i=0,n=this.oTexts.length;i<n;i++){var o=this.oTexts[i];o.id!==t?e.push(o):o.onRemove(this)}this.oTexts=e,this.renew()},removeTextsByIds:function(t){for(var e=[],i=[],n=0,o=this.oTexts.length;n<o;n++){var r=this.oTexts[n];-1===t.indexOf(r.id)?e.push(r):(r.onRemove(this),i.push(r))}return this.oTexts=e,this.renew(),i},addTexts:function(t){for(var e=0;e<t.length;e++)this.addText(t[e])},removeTexts:function(t){for(var e=t,i=e.length,n=0;n<i;n++){var o=e[n];this.removeText(o)}},getAllTexts:function(){return this.oTexts},removeAllTexts:function(){this._layerContainer.innerHTML="",this.oTexts=[],this.renew()},renew:function(){this._super();for(var t=0;t<this.oTexts.length;t++)this.oTexts[t].renew()},resize:function(){this._super(),this.renew()}}),b.Control=r.extend({init:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=(new Date).getTime()+"";this.id=t||i,this._controlContainer=this.generateContainer(),this._controlContainer.id=t,this.setControlContainerPosition(e)},setControlContainerPosition:function(t){this._postion=t.postion||t.pos||{right:0,bottom:0};var e=this._postion,i=e.left,n=e.top,o=e.right,r=e.bottom;this._controlContainer.style.position="absolute",this._controlContainer.style.display="inline-block",this._controlContainer.style.zIndex=999999,!isNaN(i)&&(this._controlContainer.style.left=i+"px"),isNaN(i)&&(this._controlContainer.style.left="auto"),!isNaN(n)&&(this._controlContainer.style.top=n+"px"),isNaN(n)&&(this._controlContainer.style.top="auto"),!isNaN(o)&&(this._controlContainer.style.right=o+"px"),isNaN(o)&&(this._controlContainer.style.right="auto"),!isNaN(r)&&(this._controlContainer.style.bottom=r+"px"),isNaN(r)&&(this._controlContainer.style.bottom="auto")},generateContainer:function(){return document.createElement("div")},setVisible:function(t){this.visible=t,this.refresh&&this.refresh()},show:function(){this.visible||this.setVisible(!0)},hide:function(){this.visible&&this.setVisible(!1)},onAdd:function(t){this._map=t,this.visible=!0;var e=this.selfContainer||this.getMapContainer();if(!e||!this._controlContainer)return!1;this.selfContainer&&(this._controlContainer.style.position="relative"),e.appendChild(this._controlContainer)},onRemove:function(){var t=this.selfContainer||this.getMapContainer();if(!t||!this._controlContainer)return!1;t.removeChild(this._controlContainer)},getMapContainer:function(){return this._map?this._map.getContainer():null},getMapContainerSize:function(){return this._map?{w:this._map.w,h:this._map.h}:null},getMapZoomScale:function(){var t=this.getMapContainer(),e=this.getMapZoom(),i=(this.getMapContainerSize()||{}).w;return!!(t&&e&&i)&&e/i},getMapZoom:function(){if(this._map)return this._map.getZoom()},getMapHZoom:function(){var t=this.getMapZoomScale(),e=this.getMapContainerSize();if(t&&e)return t*e.h},getContainerInfo:function(){this._map},boundsWatch:function(){},resize:function(){this.refresh()},refresh:function(){this.onDraw()}}),b.Control.Scale=b.Control.extend({init:function(t,e){var i=e||{};this._super(t,i),this._style=i.style||new b.Style({opacity:0}),this.type="scale"},onAdd:function(t){this._super(t),this.setContainerProps(),this.onDraw(t)},onDraw:function(){var t=this.getMapZoomScale();t&&this.setScaleContent(t)},setContainerProps:function(){if(!this._controlContainer)return console.warn("controlContainer不存在：setContainerProps:function"),!1;var t=this._style;this._controlContainer.style.fontSize=t.fontSize+"px",this._controlContainer.style.fontFamily=t.fontFamily+",SimSun",this._controlContainer.style.color=t.fontColor,this._controlContainer.style.padding="2px";var e=t.opacity||0===t.opacity?t.opacity:1,i=b.Util.colorRgb(t.bgColor,e);this._controlContainer.style.background=i},setScaleContent:function(t){if(!this._controlContainer)return console.warn("controlContainer不存在：setScaleContent:function"),!1;var e=parseInt(100*t,10)+"/100";this._controlContainer.textContent=e||"--/--"},boundsWatch:function(){this._super(),this.onDraw()}}),b.Control.EagleMap=b.Control.extend({init:function(t,e){var i=e||{};this._super(t,i),this.type="eagleMap",this._image=i.image||{src:"",width:0,height:0},this._imageId="image-"+t,this._size=i.size||{width:200,height:150},i.container&&document.getElementById(i.container)&&(this.selfContainer=document.getElementById(i.container),this.selfContainer.innerHTML=""),this._controlContainerBorderWidth=2,this._controlContainerProps={display:"-webkit-box",webkitBoxPack:"center",webkitBoxAlign:"center",boxSizing:"border-box",borderRadius:"3px",overflow:"hidden",zIndex:999999,border:this._controlContainerBorderWidth+"px solid rgb(245, 149, 7)",backgroundColor:"#fafafa"},this._highlightProps={border:"2px solid #ff0000",borderRadius:"2px",position:"absolute",boxSizing:"border-box",left:0,top:0,width:0,height:0},this._gridConfig=!!i.grid&&Object.assign({},{rowCount:3,columnCount:3,color:"#000"},i.grid),this._gridProps={position:"absolute",left:"50%",top:"50%",width:0,height:0};var n=this._gridConfig||{},o=n.columnCount,r=void 0===o?1:o,s=n.rowCount,a=void 0===s?1:s,h=n.color,l=void 0===h?"#000":h;this._gridCellProps={boxSizing:"border-box",float:"left",border:"0 dashed "+l,cursor:"pointer",width:100/r+"%",height:100/a+"%",borderRightWidth:"1px",borderBottomWidth:"1px"}},onAdd:function(t){this._super(t),this.setContainerProps(),this.addImage(),this.addHighlightRect(),this.addGrid(),this.onDraw(t)},addImage:function(){var t=this._image,e=t.src,i=t.width,n=t.height,o=this._size,r=o.width,s=o.height;this._mapImg=document.createElement("img"),this._mapImg.id=this._imageId,this._mapImg.src=e;var a="";a=r/s<=i/n?(this._mapImg.style.width="100%","width"):(this._mapImg.style.height="100%","height"),this._mapImg.style.display="block",this._mapImg.style.margin="0 auto",this._controlContainer.appendChild(this._mapImg),this.setPropsRelatedWithImage(a)},setPropsRelatedWithImage:function(t){var e=document.getElementById(this._imageId),i=this._image,n=i.width,o=i.height,r=this._size.width,s=0,a=0;this._zoom="width"===t?(a=(s=e.width)*o/n,n):"height"===t?n*r/(s=(a=e.height)*n/o):(s=e.width,a=e.height,n),this._imageScreenWidth=s,this._imageScreenHeight=a},addHighlightRect:function(){for(var t in this._highlight=document.createElement("div"),this._highlightProps)this._highlight.style[t]=this._highlightProps[t];this._controlContainer.appendChild(this._highlight)},changeHighlightRectSize:function(t,e){if(!this._highlight)return!1;this._highlight.style.width=t+"px",this._highlight.style.height=e+"px"},changeHighlightRectPosition:function(t,e){if(!this._highlight)return!1;var i=-this._controlContainerBorderWidth;this._highlight.style.left=t+i+"px",this._highlight.style.top=e+i+"px"},addGrid:function(){var t=this._imageScreenWidth,e=this._imageScreenHeight;if(this._gridConfig&&t&&e){for(var i in this._grid=document.createElement("div"),this._grid.className="gdbox-control-eagle-map-grid",this._gridProps.width=t+"px",this._gridProps.height=e+"px",this._gridProps.marginLeft=-t/2+"px",this._gridProps.marginTop=-e/2+"px",this._gridProps)this._grid.style[i]=this._gridProps[i];for(var n=this._gridConfig,o=n.columnCount,r=n.rowCount,s=0;s<r;s++)for(var a=0;a<o;a++){var h=document.createElement("div");for(var l in this._gridCellProps)h.style[l]=this._gridCellProps[l];a+1===o&&(h.style.borderRightWidth=0),s+1===r&&(h.style.borderBottomWidth=0),h.setAttribute("data-row",s+1),h.setAttribute("data-column",a+1),this.bindGridCellHoverStyle(h),this.bindGridCellEvent(h),this._grid.appendChild(h)}this._controlContainer.appendChild(this._grid)}},bindGridCellHoverStyle:function(t){t.onmouseover=function(){this.style.boxShadow="0 2px 2px gray"},t.onmouseout=function(){this.style.boxShadow="none"}},bindGridCellEvent:function(t){var s=this,e=s.getMapZoom();s._map&&e&&(t.onclick=function(){var t=1*this.getAttribute("data-row"),e=1*this.getAttribute("data-column"),i=s.getGridCellCenter(t,e),n=i.x,o=i.y,r=s.getGridCellWordWidthAndHeight().width;s._map.centerAndZoom({x:n,y:o},1.2*r)})},getGridCellCenter:function(t,e){var i=this._gridConfig||{},n=i.columnCount,o=void 0===n?1:n,r=i.rowCount,s=void 0===r?1:r,a=this.getGridCellWordWidthAndHeight(),h=a.width,l=a.height;return{x:(e-o/2)*h-h/2,y:(s/2-t)*l+l/2}},getGridCellScreenWidthAndHeight:function(){var t=this._gridConfig||{},e=t.columnCount,i=void 0===e?1:e,n=t.rowCount,o=void 0===n?1:n;return{width:this._imageScreenWidth/i,height:this._imageScreenHeight/o}},getGridCellWordWidthAndHeight:function(){var t=this.getGridCellScreenWidthAndHeight(),e=t.width,i=t.height,n=this.getEagleMapScale();return{width:n*e,height:n*i}},onDraw:function(){var t=this.getMapZoom(),e=this.getMapHZoom(),i=this.getEagleMapScale();if(!t||!e||!i)return!1;var n=parseInt(t/i,10),o=parseInt(e/i,10);this.changeHighlightRectSize(n,o);var r=this.getLeftTopWordPosition();this.changeHighlightRectPosition(r.x,r.y)},getEagleMapScale:function(){var t=this._size.width;return this._zoom/t},setContainerProps:function(){if(!this._controlContainer)return console.warn("controlContainer不存在：setContainerProps:function"),!1;for(var t in this._controlContainer.onclick=function(t){t.stopPropagation(),t.cancelBubble=!0},this._controlContainerProps)this._controlContainer.style[t]=this._controlContainerProps[t];this._controlContainer.style.width=this._size.width+"px",this._controlContainer.style.height=this._size.height+"px"},getLeftTopWordPosition:function(){var t=b.Util.screenToWorld(this._map,0,0),e=this._size,i=e.width,n=e.height,o=this.getEagleMapScale(),r=parseInt(i,10)/2,s=parseInt(n,10)/2;return{x:parseFloat(r)+parseFloat((t.x-0)/o)+0,y:parseFloat(s)-parseFloat((t.y-0)/o)+0}},boundsWatch:function(){this._super(),this.onDraw()}}),b});